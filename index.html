<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Weightless Space — A-Frame Scene with Environment</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <style>
    html, body { height: 100%; margin: 0; background: black; }
    #sceneContainer { width: 100vw; height: 100vh; overflow: hidden; }
    .ui-overlay {
      position: absolute; left: 12px; top: 12px; z-index: 10; color: white; font-family: system-ui, Arial; background: rgba(0,0,0,0.25); padding: 8px 10px; border-radius: 8px;
    }
    .ui-overlay small { display: block; opacity: 0.8 }
  </style>
</head>
<body>
  <div id="sceneContainer">
    <div class="ui-overlay">Weightless Space — move mouse / look around <small>Save as .html and open in browser</small></div>

    <a-scene background="color: #000010" renderer="antialias: true; physicallyCorrectLights: true">

      <!-- Camera rig -->
      <a-entity id="cameraRig" position="0 1.6 0">
        <a-entity id="camera" camera look-controls wasd-controls="enabled: false">
          <a-entity cursor="fuse: false; rayOrigin: mouse" position="0 0 -1" geometry="primitive: ring; radiusInner: 0.009; radiusOuter: 0.015" material="color: #ffffff; shader: flat; opacity: 0.9" visible="true"></a-entity>
        </a-entity>
      </a-entity>

      <!-- Lights -->
      <a-entity light="type: directional; color: #e0f7ff; intensity: 0.5" position="-1 2 1"></a-entity>
      <a-entity light="type: point; color: #ffd8a6; intensity: 0.4; distance: 8" position="1 0.5 -1"></a-entity>
      <a-entity light="type: ambient; color: #111428; intensity: 0.6"></a-entity>

      <!-- Sky with optional environment texture -->
      <a-assets>
        <!-- Replace 'env.jpg' with your environment image (equirectangular, JPG or PNG) -->
        <img id="envTexture" src="env.jpg" crossorigin="anonymous" />
      </a-assets>
      <a-sky id="sky" src="#envTexture" rotation="0 -90 0"></a-sky>

      <!-- Sky sphere fallback (for procedural color) -->
      <!-- <a-sphere id="skySphere" radius="60" segments-width="32" segments-height="16" scale="-1 1 1" material="shader: flat; side:back; color: #000022" position="0 0 0"></a-sphere> -->

      <!-- Nebula ring -->
      <a-entity id="nebula" geometry="primitive: ring; radiusInner: 20; radiusOuter: 55; segments: 64" rotation="-90 0 0" position="0 -8 0" material="shader: flat; opacity: 0.08"></a-entity>

      <!-- Container for dynamic objects -->
      <a-entity id="spaceObjects"></a-entity>

      <!-- Optional horizon grid -->
      <a-ring material="color: #ffffff; opacity: 0.01; side: double" radius-inner="35" radius-outer="35.25" rotation="-90 0 0"></a-ring>

    </a-scene>
  </div>

  <script>
    // ========= CONFIGURATION =========
    const PARTICLE_COUNT = 260;
    const LARGE_OBJECTS = 20;
    const ORBIT_RADIUS_MIN = 1.5;
    const ORBIT_RADIUS_MAX = 22;

    const scene = document.querySelector('a-scene');
    const spaceObjects = document.getElementById('spaceObjects');
    const cameraRig = document.getElementById('cameraRig');

    const rand = (min, max) => Math.random() * (max - min) + min;
    const choice = (arr) => arr[Math.floor(Math.random() * arr.length)];

    // Components (orbit, floaty, spin, twinkle, distance-limiter) remain unchanged
    // ... [keep all previous component code here] ...

    // Particle and large object creation functions remain unchanged
    // ... [keep createParticle, createLargeObject, buildParticles, buildLargeObjects, buildStars] ...

    function init() {
      buildStars();
      buildParticles();
      buildLargeObjects();

      // Nebula rotation
      const nebula = document.getElementById('nebula');
      nebula.object3D.rotation.x = -Math.PI/2;

      if (AFRAME.utils.device.isMobile()) {
        const children = Array.from(spaceObjects.children);
        while (children.length > 180) { spaceObjects.removeChild(children.pop()); }
      }
    }

    if (scene.hasLoaded) init(); else scene.addEventListener('loaded', init);
  </script>
</body>
</html>
